<!DOCTYPE html>
<head>
<title>resistor selection</title>
<style>
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 50%;
  text-align: left;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 13px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #1C6EA4;
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
</style>
</head>
<body>
Steps: <select id = steps>
    <option value="3">3</option>
    <option value="6">6</option>
    <option value="12">12</option>
    <option value="24">24</option>
    <option value="48">48</option>
    <option value="96" selected="selected">96</option>
</select>
<br>
Resistance (Î©): <input type="number" name="resistance" id="resistance" value="7000"> <br>
<button type="button" onclick="RunConseq();">Series</button>
<button type="button" onclick="RunParallel();">Parallel</button>
<table id="resTable" class="blueTable">
    <thead>
    <tr>
        <th>Res 1</th>
        <th>Res 2</th>
        <th>Diff</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
var nomArray = [];
var inputRes = 0;
var data = [];

function Prepare() {
    nomArray = [];
    var stepCount = document.getElementById("steps").value;
    const decimalPlaceCount = 8;
    for (place = 0; place < decimalPlaceCount; place++) {
        for (i = 0; i < stepCount; i++) {
            var item = Math.pow(10,place)*Math.round(100*Math.pow(10, i/stepCount))/100;
            nomArray.push(item);
        }
    }
    inputRes = document.getElementById("resistance").value;    
}

function FillTable(data) {
    var table = document.getElementById("resTable").getElementsByTagName('tbody')[0];
    while (table.rows.length > 0) {
        table.deleteRow(0);
    }
    for (i = 0; i < data.length; i++) {
        var newRow = table.insertRow();
        newRow.innerHTML = buildRow(data[i]);
    }
}

function RunConseq() {
    Prepare();
    data = Conseq(nomArray, inputRes);
    FillTable(data);
}

function RunParallel() {
    Prepare();
    data = Parallel(nomArray, inputRes);
    FillTable(data);
}

function Conseq(arr, target) {
    var nomLength = arr.length;
    var exactMatches = [];
    var bestMatches = [];
    const bestMatchMax = 10;
    for (i = 0; i < nomLength; i++) {
        for (j = 0; j < nomLength; j++) {
            var sum = arr[i]+arr[j];
            var diff = Math.abs(target-sum);
            var element = [arr[i], arr[j], diff];
            if (diff == 0) {
                exactMatches.push(element);
                continue;
            }
            if (bestMatches.length < bestMatchMax) {
                bestMatches.push(element)
                continue;
            }
            var worstIndex = 0;                
            for (k = 1; k < bestMatchMax; k++) {
                if (bestMatches[k][2] > bestMatches[worstIndex][2]) {
                    worstIndex = k;
                }
            }
            if (diff < bestMatches[worstIndex][2]) {
                bestMatches[worstIndex]=element;
            }
        }
    }
    bestMatches.sort(function(a,b) {return(a[2] - b[2])});
    return exactMatches.concat(bestMatches);
}

function Parallel(arr, target) {
    var nomLength = arr.length;
    var exactMatches = [];
    var bestMatches = [];
    const bestMatchMax = 10;
    for (i = 0; i < nomLength; i++) {
        for (j = 0; j < nomLength; j++) {
            var sum = arr[i]*arr[j] / (arr[i]+arr[j]);
            var diff = Math.abs(target-sum);
            var element = [arr[i], arr[j], diff];
            if (diff == 0) {
                exactMatches.push(element);
                continue;
            }
            if (bestMatches.length < bestMatchMax) {
                bestMatches.push(element)
                continue;
            }
            var worstIndex = 0;                
            for (k = 1; k < bestMatchMax; k++) {
                if (bestMatches[k][2] > bestMatches[worstIndex][2]) {
                    worstIndex = k;
                }
            }
            if (diff < bestMatches[worstIndex][2]) {
                bestMatches[worstIndex]=element;
            }
        }
    }
    bestMatches.sort(function(a,b) {return(a[2] - b[2])});
    return exactMatches.concat(bestMatches);
}

function buildRow(dataArray) {
    var row ='';
    for (var i = 0; i < dataArray.length; i++) {
        row += '<td>' + dataArray[i] + '</td>';
    }
    return row;
}


</script>
</body>
